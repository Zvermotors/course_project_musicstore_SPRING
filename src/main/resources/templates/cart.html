<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - Music Store</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bootstrap –∏ —Å—Ç–∏–ª–∏ -->
</head>
<body>
<!-- –ù–∞–≤–±–∞—Ä (–∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π catalog.html) -->

<div class="container mt-4">
    <h1>üõí –ö–æ—Ä–∑–∏–Ω–∞</h1>

    <!-- –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
    <div th:if="${userBalance != null}" class="alert alert-info">
        <h5>–í–∞—à –±–∞–ª–∞–Ω—Å: <span th:text="${#numbers.formatDecimal(userBalance, 0, 'COMMA', 2, 'POINT')}">0</span> ‚ÇΩ</h5>
        <form th:action="@{/balance/top-up}" method="post" class="d-inline">
            <input type="number" name="amount" min="1" step="0.01" placeholder="–°—É–º–º–∞" required>
            <button type="submit" class="btn btn-sm btn-success">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        </form>
    </div>

    <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
    <div th:if="${success}" class="alert alert-success" th:text="${success}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <!-- –¢–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
    <div th:if="${cart != null and !cart.items.empty}">
        <div class="row mb-3">
            <div class="col">
                <h4>–ò—Ç–æ–≥–æ: <span th:text="${#numbers.formatDecimal(cart.totalAmount, 0, 'COMMA', 2, 'POINT')}">0</span> ‚ÇΩ</h4>
                <p>–¢–æ–≤–∞—Ä–æ–≤: <span th:text="${cart.totalItems}">0</span></p>
            </div>
        </div>

        <div class="row" th:each="item : ${cart.items.values()}">
            <div class="col-md-12 mb-3">
                <div class="card">
                    <div class="row g-0">
                        <div class="col-md-2">
                            <img th:src="${item.imagePath != null} ?
                                             @{'/uploads/' + ${item.imagePath}} :
                                             @{'/images/default-product.jpg'}"
                                 class="img-fluid rounded-start"
                                 style="height: 150px; object-fit: cover;">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 th:text="${item.productName}"></h5>
                                <p class="text-muted">–¶–µ–Ω–∞: <span th:text="${#numbers.formatDecimal(item.price, 0, 'COMMA', 2, 'POINT')}">0</span> ‚ÇΩ</p>
                                <form th:action="@{/cart/update/{id}(id=${item.productId})}" method="post" class="d-inline">
                                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:</label>
                                    <input type="number" name="quantity" th:value="${item.quantity}" min="1" max="10" class="form-control d-inline-block w-25">
                                    <button type="submit" class="btn btn-sm btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-md-2 d-flex align-items-center">
                            <form th:action="@{/cart/remove/{id}(id=${item.productId})}" method="post">
                                <button type="submit" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è -->
        <div class="row mt-4">
            <div class="col-md-6">
                <form th:action="@{/cart/checkout/buy}" method="post">
                    <button type="submit" class="btn btn-success btn-lg w-100">
                        üí∞ –ö—É–ø–∏—Ç—å (<span th:text="${#numbers.formatDecimal(cart.totalAmount, 0, 'COMMA', 2, 'POINT')}">0</span> ‚ÇΩ)
                    </button>
                </form>
            </div>
            <div class="col-md-6">
                <form th:action="@{/cart/checkout/reserve}" method="post">
                    <button type="submit" class="btn btn-warning btn-lg w-100">
                        ‚è∞ –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- –ü—É—Å—Ç–∞—è –∫–æ—Ä–∑–∏–Ω–∞ -->
    <div th:if="${cart == null or cart.items.empty}" class="text-center py-5">
        <div class="alert alert-info">
            <h4>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h4>
            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ <a href="/catalog">–∫–∞—Ç–∞–ª–æ–≥</a> —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã</p>
        </div>
    </div>
</div>
</body>
</html>